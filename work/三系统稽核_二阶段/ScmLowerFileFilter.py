import pandas as pd
def ScmLowerFileFilter(excel_path):
    data = pd.read_excel(excel_path, index_col=None,  dtype={'客户': str, '销售订单号': str}, keep_default_na=False)
    print(data)
    print(data.columns)
    data['一机两票金额'] = data['一机两票金额'].astype(float)
    data['订单金额'] = data['订单金额'].astype(float)
    data['客户'] = data['客户'].astype(str)
    data['销售订单号'] = data['销售订单号'].astype(str)
    data=data[((data["订单拒绝原因"]!="00") & (data["订单拒绝原因"]!="01")) & (data["创建人"]!="RFCUSER") ]
    # 选中指定的三列
    selected_columns = data[['客户','销售订单号', '一机两票金额', '订单金额']]

    # 根据销售订单号进行分组并计算差额
    result = selected_columns.groupby(['客户','销售订单号']).apply(
        lambda x: (x['订单金额'] - x['一机两票金额']).abs().sum()
    ).reset_index()
    # 将列转换为浮点数类型
    # 重命名列
    result.columns = ['客户','销售订单号', '差额']
    result=result.values.tolist()
    for data in result:
        if data[0]=='0080041644':
            return data
    return result


def jiabaofanli_list_item(data_list):
    for data in data_list:
        data[13] = data[13][-10:]
        # print(len(data))
    # 将列表转换为 DataFrame
    df = pd.DataFrame(data_list, columns=[
        '列1', '列2', '列3', '列4', '列5', '列6', '列7', '列8', '列9', '列10',
        '列11', '列12', '列13', '销售订单号', '列15', '列16', '列17', '列18', '列19', '列20', '列21', '列22'
    ])
    # 选中指定的三列
    selected_columns = df[['销售订单号', '列11', '列12']]
    # 将列转换为浮点数类型
    selected_columns['列11'] = selected_columns['列11'].astype(float)
    selected_columns['列12'] = selected_columns['列12'].astype(float)
    selected_columns['销售订单号'] = selected_columns['销售订单号'].astype(str)
    # 根据销售订单号进行分组并计算列12和列11的差值之和
    result = selected_columns.groupby('销售订单号').apply(lambda x: (x['列12']).sum()).reset_index()
    # 重命名列
    result.columns = ['销售订单号', '差额']
    dataList=result.values.tolist()
    print(result)
    return dataList

def jibenfanliDataList(data_list):
    data_list=[['', '嘉善黄丝带通讯有限公司', '0080004103', 'jiashanhuangsidai1', '基本账户退款', '审核通过', '7320240516164251A110010006345271', '退货', '嘉兴市', '', '2024-05-16 16:38:16', '6858.00', '', '', '', '', '1', '2024-05-16 16:42:47', '', '', '正常', '客户退货5000831249', ''], ['', '杭州机皇贸易有限公司', '0080005083', 'chenguoqiang4', '基本账户退款', '审核通过', '7320240516164441A110010006345272', '退货', '杭州市', '', '2024-05-16 16:38:16', '0.11', '', '', '', '', '1', '2024-05-16 16:44:34', '', '', '正常', '客户退货5000844041', ''], ['', '杭州机皇贸易有限公司', '0080005083', 'chenguoqiang4', '基本账户退款', '审核通过', '7320240516164441A110010006345273', '退货', '杭州市', '', '2024-05-16 16:38:16', '5386.00', '', '', '', '', '1', '2024-05-16 16:44:38', '', '', '正常', '客户退货5000855580', ''], ['', '温岭市滨海创意通讯器材店', '0080210594', 'A1395860299', '基本账户退款', '审核通过', '7320240517145426A110010008127509', '退货', '台州市', '2024-05-17 00:00:00', '2024-05-17 14:49:19', '12170.00', '', '', '', '', '1', '2024-05-17 14:54:21', '', '', '正常', '撤单未退款100003031758', ''], ['', '杭州机皇贸易有限公司', '0080005083', 'chenguoqiang4', '基本账户退款', '审核通过', '7320240517161820A110010008127515', '退货', '杭州市', '', '2024-05-17 15:56:42', '0.12', '', '', '', '', '1', '2024-05-17 16:18:12', '', '', '正常', '客户退货5000844041', ''], ['', '金华市婺城区旺族通讯经营部', '0080299490', 'wz518', '基本账户退款', '审核通过', '7320240517150327A110010008127511', '退货', '金华市', '', '2024-05-17 14:56:59', '0.20', '', '', '', '', '1', '2024-05-17 15:03:25', '', '', '正常', '客户退货5000850889', ''], ['', '瑞安市乐镁通讯器材店', '0080309762', 'yaozhengchang2', '基本账户退款', '审核通过', '7320240528110219A110010022035602', '退货', '温州', '2024-05-28 00:00:00', '2024-05-28 10:22:00', '33810.00', '', '', '', '', '1', '2024-05-28 11:02:15', '', '', '正常', '客户退货5000865486', ''], ['', '开化县神州通讯器材商店', '0080005077', 'zhangweihong', '基本账户退款', '审核通过', '7320240511163946A110010000578123', '退货', '衢州市', '2024-05-11 00:00:00', '2024-05-11 16:37:54', '1352.00', '', '', '', '', '1', '2024-05-11 16:39:39', '', '', '正常', '客户退货5000852841', ''], ['', '苍南县灵溪镇猫哥通讯器材店', '0080373780', 'maoge', '基本账户退款', '审核通过', '7320240520101623A110010011744701', '退货', '温州市', '2024-05-20 00:00:00', '2024-05-20 10:11:52', '17787.00', '', '', '', '', '1', '2024-05-20 10:16:23', '', '', '正常', '客户退货5000858006', ''], ['', '温岭市新河全球通讯器材商店', '0080211518', 'A13858698823', '基本账户退款', '审核通过', '7320240510113431A110010098909105', '退货', '台州市', '2024-05-10 00:00:00', '2024-05-10 09:52:04', '14710.00', '', '', '', '', '1', '2024-05-10 11:34:31', '', '', '正常', '客户退货5000842122', ''], ['', '台州市椒江区瑞景通信设备商行', '0080445728', 'rj40235622', '基本账户退款', '审核通过', '7320240510113411A110010098909104', '退货', '台州', '2024-05-10 00:00:00', '2024-05-10 09:57:14', '1.00', '', '', '', '', '1', '2024-05-10 11:34:02', '', '', '正常', '客户退货5000842264', ''], ['', '丽水市莲都区华顺通讯器材经营部', '0080005094', 'dx7881000101', '基本账户退款', '审核通过', '7320240510113250A110010098909101', '退货', '丽水市', '2024-05-10 00:00:00', '2024-05-10 11:23:18', '14549.00', '', '', '', '', '1', '2024-05-10 11:32:41', '', '', '正常', '客户退货5000849360', ''], ['', '绍兴市柯桥区安昌镇五新通讯器材店', '0080297786', 'Cmdc40128722', '基本账户退款', '审核通过', '7320240511155504A110010000578113', '退货', '绍兴市', '2024-05-11 00:00:00', '2024-05-11 15:33:02', '9075.00', '', '', '', '', '1', '2024-05-11 15:55:02', '', '', '正常', '客户退货5000840104', ''], ['', '绍兴市柯桥区湖塘方军电话营业点', '0080042366', 'qfj13757588861', '基本账户退款', '审核通过', '7320240511155744A110010000578114', '退货', '绍兴市', '2024-05-11 00:00:00', '2024-05-11 15:33:02', '2354.00', '', '', '', '', '1', '2024-05-11 15:57:41', '', '', '正常', '客户退货5000845667', ''], ['', '绍兴市柯桥区湖塘智汇手机店', '0080318734', 'Cmdc40138559', '基本账户退款', '审核通过', '7320240511160044A110010000578115', '退货', '绍兴市', '2024-05-11 00:00:00', '2024-05-11 15:33:02', '4708.00', '', '', '', '', '1', '2024-05-11 16:00:36', '', '', '正常', '客户退货5000845668', ''], ['', '绍兴柯桥雨辰通信器材有限公司', '0080394606', 'Cmdc40211391', '基本账户退款', '审核通过', '7320240511160104A110010000578116', '退货', '绍兴', '2024-05-11 00:00:00', '2024-05-11 15:33:02', '2354.00', '', '', '', '', '1', '2024-05-11 16:01:00', '', '', '正常', '客户退货5000845669', ''], ['', '义乌市璇木手机店', '0080040437', 'Cmdc10204484', '基本账户退款', '审核通过', '7320240511140549A110010000578110', '退货', '金华市', '2024-05-11 00:00:00', '2024-05-11 13:52:08', '430.00', '', '', '', '', '1', '2024-05-11 14:05:39', '', '', '正常', '客户退货5000852676', ''], ['', '义乌市璇木手机店', '0080040437', 'Cmdc10204484', '基本账户退款', '审核通过', '7320240511140538A110010000578109', '退货', '金华市', '2024-05-11 00:00:00', '2024-05-11 13:52:08', '14380.00', '', '', '', '', '1', '2024-05-11 14:05:37', '', '', '正常', '客户退货5000852684', ''], ['', '绍兴越城灵动手机店', '0080454182', 'sxlingdong', '基本账户退款', '审核通过', '7320240511155253A110010000578112', '退货', '绍兴', '2024-05-11 00:00:00', '2024-05-11 15:16:11', '950.00', '', '', '', '', '1', '2024-05-11 15:52:44', '', '', '正常', '客户退货5000852840', ''], ['', '台州市椒江亿博通信设备商行', '0080326373', 'A18869999909', '基本账户退款', '审核通过', '7320240430141202A110010079310915', '退货', '台州', '2024-04-30 00:00:00', '2024-04-30 14:00:37', '4617.00', '', '', '', '', '1', '2024-04-30 14:12:02', '', '', '正常', '客户退货5000833153', ''], ['', '平阳县仁誉通讯设备经营部', '0080319823', 'pyry', '基本账户退款', '审核通过', '7320240523141200A110010016182307', '退货', '温州市', '2024-05-23 00:00:00', '2024-05-23 14:09:55', '3959.00', '', '', '', '', '1', '2024-05-23 14:11:56', '', '', '正常', '客户退货5000858007', ''], ['', '玉环轩豪通讯设备商行', '0080173338', 'zhangjinxiang2', '基本账户退款', '审核通过', '7320240523141710A110010016182308', '退货', '台州市', '2024-05-23 00:00:00', '2024-05-23 14:09:55', '8095.00', '', '', '', '', '1', '2024-05-23 14:17:11', '', '', '正常', '客户退货5000857075', ''], ['', '杭州萧山新塘特慧通讯器材经营部', '0080042013', 'xiashajunjie', '基本账户退款', '审核通过', '7320240530170949A110010024208230', '退货', '杭州市', '2024-05-30 00:00:00', '2024-05-30 10:59:43', '20116.00', '', '', '', '', '1', '2024-05-30 17:09:47', '', '', '正常', '客户退货5000867319', ''], ['', '乐清市虹桥阿新手机店', '0080350510', 'zj0_1177', '基本账户退款', '审核通过', '7320240514154607A110010004164018', '退货', '温州市', '2024-05-14 00:00:00', '2024-05-14 15:16:41', '38944.00', '', '', '', '', '1', '2024-05-14 15:46:05', '', '', '正常', 'SCM制单5000855581', ''], ['', '龙港市大机汇手机店', '0080393242', 'dajihui', '基本账户退款', '审核通过', '7320240514154637A110010004164019', '退货', '温州市', '2024-05-14 00:00:00', '2024-05-14 15:16:41', '9580.00', '', '', '', '', '1', '2024-05-14 15:46:33', '', '', '正常', 'SCM制单5000855582', ''], ['', '台州市黄岩白云通讯经营部', '0080043394', 'dx7662037801', '基本账户退款', '审核通过', '7320240527103958A110010020136504', '退货', '台州市', '2024-05-27 00:00:00', '2024-05-27 10:19:43', '6085.00', '', '', '', '', '1', '2024-05-27 10:39:53', '', '', '正常', '客户退货5000866782', ''], ['', '杭州君彦科技有限公司', '0080041770', 'Cmdc10225885', '基本账户退款', '审核通过', '7320240527105859A110010020136505', '退货', '杭州市', '2024-05-27 00:00:00', '2024-05-27 10:51:25', '4045.00', '', '', '', '', '1', '2024-05-27 10:58:54', '', '', '正常', '客户退货5000732803', ''], ['', '宁波全线通通讯设备有限公司', '0080004653', 'qxt888888', '基本账户退款', '审核通过', '7320240527144530A110010020136516', '退货', '宁波市', '2024-05-27 00:00:00', '2024-05-27 13:51:52', '6679.00', '', '', '', '', '1', '2024-05-27 14:45:23', '', '', '正常', '客户退货5000866781', ''], ['', '浦江县启帆手机店', '0080039508', 'hhk10230579', '基本账户退款', '审核通过', '7320240506103228A110010092048403', '退货', '金华市', '2024-05-06 00:00:00', '2024-05-06 10:21:41', '3093.75', '', '', '', '', '1', '2024-05-06 10:32:25', '', '', '正常', '客户退货5000833152', ''], ['', '浦江县启帆手机店', '0080039508', 'hhk10230579', '基本账户退款', '审核通过', '7320240506103228A110010092048404', '退货', '金华市', '2024-05-06 00:00:00', '2024-05-06 10:21:41', '6672.00', '', '', '', '', '1', '2024-05-06 10:32:28', '', '', '正常', '客户退货5000833791', ''], ['', '嘉兴凯易通讯科技有限公司', '0080404039', 'kaiyi', '基本账户退款', '审核通过', '7320240506102928A110010092048402', '退货', '嘉兴', '2024-05-06 00:00:00', '2024-05-06 10:26:21', '18240.00', '', '', '', '', '1', '2024-05-06 10:29:24', '', '', '正常', '客户退货5000833920', ''], ['', '话机世界通信集团股份有限公司', '0080191048', 'Cmdc80191048', '基本账户退款', '审核通过', '7320240515103019A110010005355007', '退货', '杭州', '', '2024-05-15 10:19:02', '0.18', '', '', '', '', '1', '2024-05-15 10:30:13', '', '', '正常', '客户退货5000855584', ''], ['', '平湖市林埭镇博诚通讯店', '0080353448', 'zj5_2307', '基本账户退款', '审核通过', '7320240515103109A110010005355008', '退货', '嘉兴市', '', '2024-05-15 10:22:42', '2352.00', '', '', '', '', '1', '2024-05-15 10:31:01', '', '', '正常', '客户退货5000855583', ''], ['', '金华市婺城区旺族通讯经营部', '0080299490', 'wz518', '基本账户退款', '审核通过', '7320240515163731A110010005355017', '退货', '金华市', '', '2024-05-15 16:34:02', '0.19', '', '', '', '', '1', '2024-05-15 16:37:23', '', '', '正常', '客户退货5000850889', ''], ['', '仙居县佳海通讯器材经营部', '0080041209', 'xj10031053', '基本账户退款', '审核通过', '7320240515163821A110010005355018', '退货', '台州市', '', '2024-05-15 16:34:02', '11360.00', '', '', '', '', '1', '2024-05-15 16:38:16', '', '', '正常', '客户退货5000852842', ''], ['', '杭州虎虎商务服务有限责任公司', '0080454753', 'hhsw8', '基本账户退款', '审核通过', '7320240524141427A110010017171205', '退货', '杭州', '', '2024-05-24 14:06:22', '1.00', '', '', '', '', '1', '2024-05-24 14:14:20', '', '', '正常', '客户退货5000865752', '']]
    for data in data_list:
        data[-2]=data[-2][-10:]
        # if data[-2]=="5000867319":
        #     print(data)
        #     print(len(data))
        # print(len(data))
    # 将列表转换为 DataFrame
    df = pd.DataFrame(data_list, columns=[
        '列1', '列2', '列3', '列4', '列5', '列6', '列7', '列8', '列9', '列10',
        '列11', '金额', '列13', '列14', '列15', '列16', '列17', '列18', '列19', '列20', '列21', '销售订单号','列23'
    ])

    # # 选中指定的三列
    selected_columns = df[['销售订单号', '金额']]
    #
    # # 将列转换为浮点数类型
    selected_columns['金额'] = selected_columns['金额'].astype(float)
    selected_columns['销售订单号'] = selected_columns['销售订单号'].astype(str)
    # selected_columns['列12'] = selected_columns['列12'].astype(float)
    #
    # # 根据销售订单号进行分组并计算列12和列11的差值之和
    result = selected_columns.groupby('销售订单号').apply(lambda x: (x['金额'] ).sum()).reset_index()
    #
    # # 重命名列
    result.columns = ['销售订单号', '差额']
    result_dataList=result.values.tolist()

    # print(result)
    return result_dataList



if __name__ == '__main__':
    excel_path=r"C:\Users\ly320\Desktop\三系统余额稽核二阶段\scmLower\24.6.21-1.xlsx"
    result=ScmLowerFileFilter(excel_path)
    print(result)

